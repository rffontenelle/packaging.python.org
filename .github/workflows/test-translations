name: Build translated docs

on:
  workflow_dispatch:
  push:
    branches:
      - translation/source
    paths:
      - 'locales/**/*.po'
      - '.github/workflows/test-translations.yml'
  pull_request:
    paths:
      - 'locales/**/*.po'
      - '.github/workflows/test-translations.yml'

permissions:
  contents: read

jobs:
  build:
    name: ${{ matrix.noxenv }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        noxenv:
        - build
        - linkcheck
        languages:
        - ar
        - ars
        - de
        - eo
        - es
        - fa
        - fil
        - fr
        - frc
        - gl
        - hi
        - id
        - ja
        - mk
        - pt_BR
        - ro
        - ru
        - si
        - uk
        - zh_Hans
        - zh_Hant

    steps:
      - uses: actions/checkout@v3
        with:
          ref: 'translation/source'

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.9
          cache: 'pip'
          cache-dependency-path: 'requirements.txt'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade nox virtualenv
      - name: Nox ${{ matrix.noxenv }}
        run: |
          python -m nox -s ${{ matrix.noxenv }} -- -D language=${{ matrix.languages }}
